<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Classification AI</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Text Suspicion Classifier</h1>
        <textarea id="textInput" placeholder="Enter text here..."></textarea>
        <button id="analyzeButton">Analyze</button>
        <p id="result">Suspicion Score: --</p>
    </div>


    <script type="module">
            
        import { AutoTokenizer, pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers";


        // load huggingface models 

        const tokenizer = await AutoTokenizer.from_pretrained("BAAI/bge-large-en-v1.5");
        console.log("TOKENIZER"); 
        console.log(tokenizer); 
        /*const model = await AutoModel.from_pretrained("Xenova/bge-large-en-v1.5");
        console.log("MODEL"); 
        console.log(model); */
        // Create a feature-extraction pipeline
        



        //var text = "Kill me now"; 




        async function get_embeddings(in_text) { // get embedding for just one piece of text only - unbatched 
            const output = []; 
            //console.log("NUM BATCEHS");
            //console.log(num_batches);

            //let encoded_input = tokenizer(in_text);
            //console.log(encoded_input)
            //console.log("GET EMBEDDINGS"); 
            //console.log(in_text); 
            const extractor = await pipeline('feature-extraction', 'Xenova/bge-large-en-v1.5');
            let a = await extractor([in_text, 'bye'], {pooling: "mean", normalize:true});
            //console.log(a[0].tolist());
            return a[0].tolist();
            
            /*let model_output = await(model(encoded_input, {maxLength: 512, })); 
            //console.log("MODEL OUTPUT ");
            //console.log(i); 
            let emb = model_output['last_hidden_state'][0][0]; 

            // L2 normalization 
            let suml = 0.0; 
            for (let j=0; j<1024; j++) {
                suml += emb[j].item()**2; 
            }

            emb = emb.div(Math.sqrt(suml)); 



            //return emb; 
            let t = 0; 
            for (let j=0; j<1024; j++) {
                output.push(emb[j].item()); 
                t += emb[j].item(); 
            }
            console.log("SHLD  BE 1"); 
            console.log(t);

            return output; // as a list of length 1024 

            //output.push(emb.div(suml)); 
                

            //return new Tensor('float32', output, [num_batches, 1024]); 
            */
        }








        // lionguard model stuff 
        const lc_1 = [1.0661829710006714, -0.5472571849822998, -1.1392202377319336, -0.0808800756931305, 0.6295453310012817, 0.647700846195221, -0.793031632900238, -0.4261828660964966, -1.6846762895584106, -0.22658826410770416, 0.599183976650238, 0.1817959100008011, -0.29108959436416626, 0.21897107362747192, 1.3139618635177612, -0.284625768661499, -0.08629206568002701, -0.8970891237258911, -0.9054614901542664, -0.558278501033783, 0.7894901037216187, 0.6872668266296387, -0.477854460477829, -1.420068621635437, 0.9008541703224182, -1.529801368713379, -0.44998443126678467, 1.1821811199188232, -0.7922796010971069, -1.33797287940979, 0.8629316091537476, -1.3056697845458984, 0.6658530831336975, -0.7268689870834351, 1.1782957315444946, -0.6754181385040283, 1.0292655229568481, 0.550674557685852, -0.6858031749725342, -0.017535272985696793, -0.32608354091644287, -2.1613497734069824, -0.22565104067325592, -0.13278557360172272, 0.8203733563423157, -0.030204428359866142, 0.36761942505836487, 0.714520275592804, 0.8860564827919006, -0.537175178527832, 1.4182684421539307, -0.9872970581054688, -0.3570241630077362, -0.3150622844696045, 0.3529241383075714, -0.9890862107276917, 0.9710509777069092, -0.14577549695968628, 0.5051265954971313, -0.08194220066070557, 2.392770767211914, -0.02892320044338703, 0.20677170157432556, -0.8462529182434082, 0.7966364622116089, -0.9730783700942993, 0.7251518368721008, -1.2183178663253784, -1.701359748840332, 0.07877626270055771, 0.6028337478637695, 1.5426006317138672, -0.4159344732761383, -1.7054206132888794, 0.1401057243347168, 1.053174376487732, -0.07138030976057053, -1.0769730806350708, 0.8619430065155029, 0.36434587836265564, 2.199711799621582, -0.49426954984664917, 1.7536685466766357, 2.1136415004730225, 0.06102330982685089, -0.08439145237207413, -1.2604601383209229, 0.24726268649101257, -0.2102738618850708, -0.3464592397212982, -0.4207925498485565, 1.0278151035308838, -1.0481293201446533, 0.679033637046814, 0.9668673872947693, -0.3160710632801056, 1.3882249593734741, -0.5620542168617249, -0.7488242983818054, 0.8447160720825195, 0.7510209679603577, -0.8875809907913208, -0.22643055021762848, -0.5170883536338806, -1.2348448038101196, 0.4295291304588318, 0.8323308825492859, -0.1253839135169983, -1.1000367403030396, 0.6881812214851379, -0.911372184753418, -0.13108107447624207, -0.45138314366340637, -0.3241210877895355, -0.6557282209396362, -1.413110375404358, -1.3473403453826904, 0.432901531457901, -1.0190978050231934, -0.5403207540512085, 0.1755390465259552, -1.0992761850357056, -0.2849789261817932, -1.3318263292312622, -0.055524978786706924, -1.0561280250549316, -1.2244166135787964, 0.7119138836860657, -1.3700507879257202, 1.333056926727295, -0.2751549184322357, -0.6724317669868469, -1.5853707790374756, -0.9184734225273132, -0.04959099739789963, -0.9743736386299133, 0.9070384502410889, 0.1992419809103012, 1.0489469766616821, 0.7349807620048523, -0.05525879189372063, 0.928248941898346, 0.4724704623222351, 1.3964693546295166, 0.9416720271110535, -0.19802388548851013, -1.5640653371810913, -1.03020179271698, -0.1047964096069336, 0.8046356439590454, -1.0700137615203857, -1.6845393180847168, 0.5070054531097412, -0.4394586980342865, 0.8121939301490784, 0.5267233848571777, -0.6179817318916321, 0.3117545247077942, -0.5760967135429382, -0.2738398313522339, 0.07071829587221146, -0.6443067193031311, -0.45901331305503845, -1.0111783742904663, -0.4794585406780243, 1.1073036193847656, -1.2829867601394653, 1.7717052698135376, 0.11231953650712967, -0.6327570080757141, 0.1494837999343872, -0.09276459366083145, -0.1639484167098999, -0.24998416006565094, 1.2955507040023804, 1.2245067358016968, 0.2731684446334839, 0.7790044546127319, 0.010017014108598232, 0.055076103657484055, 0.8400669097900391, 1.6888201236724854, 0.4014594852924347, -0.21302910149097443, 0.6540682315826416, -1.2673884630203247, 0.7745606303215027, -0.19222615659236908, 0.4857851266860962, 0.3386495113372803, 2.2007789611816406, 0.14120928943157196, -0.6715924739837646, 0.5927761197090149, 0.2765882611274719, 0.22623877227306366, -0.5999243855476379, -0.00640112953260541, -0.04538397863507271, 0.10105355083942413, 0.43583205342292786, 1.146399736404419, -0.3320522904396057, 0.33543169498443604, -0.46410736441612244, -1.6322636604309082, -0.3179364800453186, 1.9942736625671387, -0.49393215775489807, -0.1083536446094513, -0.192934051156044, 0.4154397249221802, -0.42140111327171326, -0.2612200975418091, -1.142572045326233, -1.1904782056808472, 1.0899708271026611, 0.25787603855133057, 0.8140689134597778, -0.8632943630218506, -0.544079601764679, -0.3379339575767517, -0.23150373995304108, 1.1101093292236328, 0.9757753014564514, 2.100857734680176, -0.6876305937767029, 0.6621015667915344, 1.4218688011169434, 0.3168184757232666, 0.8262543082237244, 1.386853814125061, -1.1042518615722656, -0.11809387058019638, -0.643848717212677, -0.7091337442398071, 1.3543404340744019, 0.5621615052223206, 0.9264821410179138, -1.4426698684692383, -1.0713187456130981, -0.4443243443965912, 0.2570103704929352, 0.6657496690750122, -0.5760914087295532, -0.41136762499809265, 1.0510334968566895, 0.48395276069641113, -0.2745197117328644, 0.047744978219270706, -0.017799725756049156, 1.5208871364593506, 0.4261658489704132, 0.9127674698829651, -0.39544275403022766, -1.0047235488891602, 1.2402632236480713, 0.24419812858104706, 0.4802369177341461, -0.11543242633342743, -0.7053598165512085, -0.3034316599369049, -0.9548950791358948, -0.7807804346084595, 1.6154837608337402, -1.5550870895385742, -1.5084391832351685, -0.5675899982452393, -0.21335387229919434, 0.5930768251419067, -0.5964335203170776, -0.4329814016819, 0.820793867111206, -0.7378808856010437, 1.5742244720458984, 0.6059620380401611, 0.554633617401123, -1.8485603332519531, 0.49243101477622986, 0.8435821533203125, 0.42648255825042725, -1.0344054698944092, -0.8791437149047852, -0.465991735458374, 0.6279382109642029, -1.2472121715545654, -0.5860143899917603, -1.2824878692626953, 0.8159301280975342, -0.6452261805534363, -0.23155169188976288, -0.6488760709762573, -1.344387173652649, -0.9585906863212585, 0.16077516973018646, 0.6130498051643372, 0.6438561081886292, 0.20484791696071625, -0.13341455161571503, 0.4994094967842102, 0.0969226211309433, -1.0205419063568115, -0.13674409687519073, -1.5987545251846313, -0.5124110579490662, -0.23849573731422424, 1.4903385639190674, -0.7527183890342712, 0.6296637654304504, 0.43575721979141235, 0.40520066022872925, 0.11776049435138702, -0.23708590865135193, -0.23217754065990448, 0.0094216363504529, 1.1906628608703613, 0.5085506439208984, 0.5960071682929993, -0.5609821081161499, -0.10129517316818237, -0.4947306513786316, 0.33961424231529236, 0.504918098449707, 1.2603169679641724, 0.8800509572029114, 0.8440259099006653, -1.1316438913345337, -0.17254750430583954, -0.08413979411125183, 1.0629820823669434, -0.22171461582183838, 0.5212217569351196, 1.2388142347335815, -0.35442182421684265, 0.9597428441047668, -0.3432522416114807, 0.5048516988754272, -1.29493248462677, -1.1085585355758667, -0.11655250936746597, -0.4584404528141022, -1.2298328876495361, -0.008753534406423569, 0.23877665400505066, -1.225690484046936, -1.089681625366211, 1.825888991355896, 0.7231826782226562, 0.35043931007385254, -0.14740228652954102, -1.0352240800857544, -0.08770578354597092, 0.7542410492897034, -0.8480784296989441, -0.01148966234177351, 0.597528338432312, 0.8485603928565979, -0.2644566297531128, 0.6273412108421326, -1.1619455814361572, 0.397733598947525, -0.6539760231971741, -0.6121614575386047, 0.3785015046596527, 0.21187765896320343, -2.0683341026306152, -1.0494259595870972, 0.17650234699249268, -2.0310218334198, 1.2941672801971436, 0.24858589470386505, 0.6152888536453247, 0.2137037217617035, -0.5827468633651733, -1.623464584350586, 0.0686279833316803, 0.2241513878107071, 0.9343122839927673, 0.8422544002532959, 0.0468660444021225, 0.8964114189147949, 0.7587490677833557, -0.29988938570022583, 0.23248882591724396, -0.3645113408565521, 1.22982656955719, -2.1007704734802246, -1.2777420282363892, -1.2511664628982544, -0.16586990654468536, 0.4465316832065582, -0.500400185585022, 0.5786061882972717, 0.321737140417099, -0.9566043615341187, 0.08378804475069046, -1.6454561948776245, 0.6144718527793884, 0.7665067315101624, 0.2822573781013489, -0.17366230487823486, 0.1187087744474411, -0.5870460867881775, 0.5473626852035522, 0.9610859751701355, 1.3603966236114502, 0.7381040453910828, -0.5336830615997314, 0.26088613271713257, 0.5485398173332214, -0.7864149808883667, 0.4401416778564453, 0.130745530128479, -1.5892019271850586, -0.7192145586013794, 0.28503817319869995, 0.7782279253005981, 0.16888146102428436, 1.6445109844207764, -0.32428407669067383, -1.0160470008850098, 1.1001616716384888, -0.025211850181221962, 0.4727138876914978, -0.44706016778945923, -0.5877634286880493, 0.4172959625720978, 0.46749386191368103, 0.07140561938285828, 0.6485755443572998, 0.8610894083976746, 1.171990990638733, -0.32235804200172424, -0.7561531662940979, -0.790199339389801, 0.2099795937538147, -0.010859644040465355, 0.3984294831752777, 0.11283978074789047, 0.8569097518920898, -0.5286192297935486, -1.0935028791427612, 1.601746916770935, -0.7371528744697571, -1.3282160758972168, 0.5157538056373596, 0.5718446373939514, -0.7193531394004822, -1.141492486000061, -0.07829930633306503, 0.28201186656951904, -0.38425305485725403, -0.14383211731910706, 0.35889932513237, 2.2209279537200928, -0.23958483338356018, -0.2530793845653534, 0.06626375764608383, 1.1133326292037964, -0.3551468253135681, 0.4559134244918823, -1.4503979682922363, -0.047072723507881165, -0.6241629719734192, -0.1707119345664978, -0.9915011525154114, -0.5230757594108582, 1.7007312774658203, 0.16668207943439484, -0.4542359411716461, 1.2528916597366333, 1.5185253620147705, 0.2101949155330658, 0.9921123385429382, 0.5922244787216187, 0.8212897777557373, -0.5435959100723267, -0.8881778120994568, 0.37053540349006653, -0.4183761179447174, 0.635377824306488, 0.5767219066619873, 0.2746890187263489, -0.5924685597419739, 0.04396599531173706, -0.3409675657749176, -0.20595160126686096, -0.6736453175544739, 1.1287590265274048, 0.4256817102432251, 0.43249696493148804, -1.4972447156906128, -1.1688958406448364, -1.3632131814956665, 0.07757106423377991, -0.16297045350074768, -1.6316322088241577, -0.9149911403656006, 0.5125669836997986, 0.9421460628509521, 0.45919474959373474, 0.8783238530158997, -0.03962818160653114, 0.6896275281906128, 0.24579256772994995, 0.018529988825321198, -0.33122718334198, 0.9586028456687927, 0.4969359040260315, 1.0589218139648438, -0.8620158433914185, -0.3864244520664215, 1.6094006299972534, 0.049916498363018036, 0.20614175498485565, -0.31442248821258545, -1.3837225437164307, -0.13797661662101746, -0.8505424857139587, -0.8104932308197021, -0.030639171600341797, -0.10123493522405624, 0.31185683608055115, 2.2667808532714844, 1.5693492889404297, -0.4341522753238678, -0.2606552839279175, -0.10551302134990692, 0.763862669467926, -0.4531415104866028, -1.809305191040039, -0.17891918122768402, -1.683210015296936, 0.20950984954833984, 0.4537007510662079, -0.5601757168769836, 1.134386420249939, -0.28282055258750916, 0.34416458010673523, 0.3655790090560913, 0.44044259190559387, -0.30965474247932434, -0.7414956092834473, 1.1348655223846436, -0.34158703684806824, 0.3396863341331482, -0.17818062007427216, -0.20948150753974915, 0.4344036281108856, -0.09985608607530594, 0.26008960604667664, 1.3311678171157837, 0.473409503698349, 1.0954217910766602, 0.7398756146430969, 1.3907616138458252, 1.8891382217407227, 0.8063530325889587, 0.3675565719604492, 0.671619176864624, 0.4263286888599396, 0.41358816623687744, -0.4208953082561493, -0.8150646686553955, 0.6223886013031006, -0.707963764667511, -1.0704374313354492, -0.4999077618122101, -1.9187527894973755, -0.986088752746582, 0.4244491159915924, 0.14970123767852783, -1.1954147815704346, 1.7306294441223145, 0.5488074421882629, -0.4662451446056366, -0.7996801733970642, 0.08905784785747528, -0.6041924357414246, 0.8436711430549622, -1.0331755876541138, 1.65118408203125, 0.7314013242721558, 1.0005295276641846, -0.9578230977058411, -0.09634853154420853, 0.41994577646255493, 0.9164920449256897, 0.23052233457565308, 0.04116206243634224, -0.18903930485248566, -0.4480460286140442, 0.4426887333393097, -0.5383865833282471, -1.383025884628296, 0.42407459020614624, 0.590252161026001, 1.060595989227295, -0.6411851048469543, 0.3634684085845947, -0.6978468298912048, 1.144410490989685, -0.2727232575416565, 0.2581348419189453, 0.8281500935554504, -0.2136855274438858, 0.25585684180259705, 0.031303830444812775, 0.17843785881996155, -0.8036261796951294, 0.888961136341095, 0.4282010793685913, -0.2109382003545761, 1.9570709466934204, -0.6348978281021118, -0.08374135941267014, 0.20727506279945374, -0.8011395335197449, -0.34270575642585754, 1.1264386177062988, -2.63773250579834, -0.5111460089683533, -0.8673079013824463, -0.09906259924173355, -1.701849341392517, 0.22831276059150696, 0.6552266478538513, -0.5658032894134521, 0.3198329210281372, 0.19562415778636932, -0.5082681179046631, -1.187522530555725, -0.3086257874965668, 0.6333871483802795, 0.6525372862815857, 0.4240732789039612, 2.1634411811828613, -0.8517602682113647, -0.011659152805805206, 0.010716701857745647, 1.1464262008666992, 0.8692484498023987, -0.5773381590843201, -0.1078704223036766, 1.123963713645935, -0.16822248697280884, -0.059177421033382416, -0.4440386891365051, 1.350463628768921, -0.5120388865470886, -0.49823418259620667, -2.2237777709960938, 0.27275267243385315, 0.6979078054428101, -1.2226828336715698, 0.2733086943626404, -0.05234025791287422, 0.8072131276130676, 0.540002703666687, 0.8018510341644287, -0.5977261066436768, -0.321058452129364, -0.600947380065918, -0.3679277300834656, 0.12275582551956177, 0.1300046145915985, 0.5619321465492249, 1.2048910856246948, -0.41526874899864197, 0.08333893865346909, 0.9300814867019653, 0.794257640838623, -0.20154820382595062, -0.5210697650909424, 1.310945987701416, 1.6029574871063232, -0.037671398371458054, 0.7281816005706787, -0.4522906243801117, 0.03966279700398445, 0.10445041209459305, 0.8526306748390198, 0.31848806142807007, 1.5455538034439087, -0.1905781626701355, 0.008632553741335869, 0.8651857376098633, -0.011454125866293907, -1.4335682392120361, -0.5797480344772339, 1.3870501518249512, -0.5000194311141968, 0.058627836406230927, 0.23741376399993896, 0.5735228061676025, -0.6684846878051758, -0.727344810962677, 0.49061599373817444, -0.14064671099185944, 0.15371288359165192, -0.44286611676216125, 0.08377291262149811, 0.29293444752693176, 0.1521528661251068, 0.38212865591049194, -1.0322089195251465, 1.367984414100647, -0.57193523645401, -0.48718366026878357, -0.7303197383880615, -0.2575449049472809, 1.3379762172698975, -0.30266502499580383, 1.1601415872573853, 0.7722083926200867, -1.0671354532241821, -1.1238501071929932, -0.063595712184906, -1.2376176118850708, 0.7756164073944092, -1.1022571325302124, 0.5092670917510986, -0.7776473164558411, 1.1942920684814453, 0.3775547742843628, 0.5443888902664185, 2.3324692249298096, -0.4382816553115845, 1.6222120523452759, 0.6619446873664856, 1.1074135303497314, -0.2427062690258026, -1.179482102394104, 0.08344706892967224, -0.5699450969696045, -0.42464810609817505, -0.9795376062393188, -1.2156864404678345, 1.178627610206604, -0.8674386739730835, 0.43182888627052307, -1.2356079816818237, 0.2739313542842865, 0.22664684057235718, 0.25933143496513367, -0.3408452868461609, -1.757491111755371, 0.8128768801689148, -0.28642696142196655, -0.16293181478977203, -0.2972750663757324, -0.8727391362190247, 0.8438175320625305, -2.170666456222534, -0.23459561169147491, 1.2857303619384766, -0.14290429651737213, -0.9655522704124451, -0.23565863072872162, 0.6346884965896606, -0.10425236821174622, -1.7831554412841797, -0.7437027096748352, 0.14749537408351898, 0.13207629323005676, 0.8005791306495667, -0.6466377973556519, -1.094274640083313, 0.8040089011192322, 0.01080379355698824, -0.5854330062866211, -0.6853048205375671, -0.512698769569397, 0.24020586907863617, 0.4020511209964752, -1.0916703939437866, -0.8603355288505554, 0.43457844853401184, -1.1574599742889404, -0.22553762793540955, 0.33017078042030334, 0.7519611716270447, -0.5083791613578796, -0.5618558526039124, -1.354575753211975, 0.020880436524748802, 0.2564048171043396, -1.3339098691940308, -0.10996213555335999, -1.0310994386672974, 0.18140330910682678, 0.050781525671482086, -0.30815228819847107, -1.153844952583313, -0.1364513337612152, 0.052594561129808426, 1.3577831983566284, 0.9509709477424622, -0.15446890890598297, -1.6926579475402832, -0.7509031295776367, -0.41477903723716736, -0.07194380462169647, -1.1210802793502808, -0.4956713318824768, 1.2505055665969849, 1.1312373876571655, -0.6747045516967773, -1.4708527326583862, 1.9147268533706665, 0.42073798179626465, 0.3299495279788971, 0.06664513796567917, 0.2532210946083069, 1.2822598218917847, 0.32678455114364624, -0.3239840567111969, 0.05624234303832054, 0.022592011839151382, 0.9257200360298157, -0.01158879604190588, -0.7919525504112244, 0.5075334906578064, 2.077528476715088, 0.08079773187637329, 0.4473390579223633, 0.8383201956748962, 1.4332212209701538, 1.3422850370407104, 0.6036754846572876, -0.5510310530662537, 0.9417875409126282, 0.16817058622837067, -0.628392219543457, -0.5537375211715698, 1.583580493927002, 0.1417010873556137, 0.02699572965502739, -0.554792046546936, -0.41547900438308716, 0.18922995030879974, -1.1493269205093384, -0.8761655688285828, -0.06558071821928024, -0.6901044845581055, 0.6013064980506897, 0.3673771023750305, -0.860679566860199, 0.35557687282562256, -0.5216032862663269, -1.3061798810958862, -0.5575249791145325, 1.2161650657653809, 0.07890333235263824, -0.5636555552482605, -0.5456041693687439, -0.36616891622543335, 0.8994648456573486, 0.31151360273361206, 0.2072666436433792, -0.5712326765060425, -0.5204192399978638, -0.9506138563156128, -0.28764957189559937, -0.14456351101398468, -0.46602869033813477, -0.8380717039108276, 0.5278869271278381, 0.17536702752113342, -0.9244934916496277, -0.2347574532032013, 0.3390710949897766, 0.6103672385215759, -1.3722666501998901, -1.2463206052780151, -0.9455265998840332, -0.2641271948814392, 0.4147810637950897, -1.136275053024292, -0.05024407431483269, -0.1505531668663025, -0.10222470760345459, 0.3061732351779938, -1.3498005867004395, -0.8182213306427002, -0.36465391516685486, -0.9573412537574768, 0.40239232778549194, -0.11338178813457489, -0.2592054009437561, -0.7924221754074097, 0.3510756194591522, 0.09684659540653229, -0.11288200318813324, -1.7120920419692993, 0.6938061118125916, -0.49892789125442505, 0.47499293088912964, 2.0859193801879883, 0.8710408806800842, 0.17024293541908264, 0.06480610370635986, 0.3867111802101135, -0.09695418924093246, -0.4954443573951721, 1.78585684299469, -0.48948079347610474, 0.5826638340950012, 0.1577051728963852, -0.15353046357631683, -0.6031437516212463, 0.8618345856666565, -0.2984180450439453, -0.5735246539115906, -0.04412640631198883, -0.2515358030796051, 0.12375377118587494, -0.9770550727844238, -0.21587423980236053, 0.4863339364528656, -0.98398756980896, -0.33520036935806274, 0.8217064738273621, -0.02566666714847088, -2.707029342651367, -0.43518638610839844, -0.8655102252960205, -1.0659091472625732, -0.08486685156822205, 0.5879994034767151, -0.46058714389801025, -0.7833598852157593, 0.793677806854248, 1.3105500936508179, -0.582719087600708, -0.46360594034194946, 0.025255069136619568, 0.7688156962394714, -0.4477606415748596, 0.539854109287262, 0.38315075635910034, 0.7960988879203796, -1.31903076171875, 0.5325899720191956, -0.3319660425186157, -0.5383375883102417, -0.9680008888244629, 1.0555388927459717, -0.5599019527435303, 0.15500611066818237, -1.075761318206787, 1.5677818059921265, -0.09227658808231354, 1.5660308599472046, 1.2000352144241333, -0.9292405247688293, -0.7948594093322754, 1.0168553590774536, 0.7009089589118958, 0.707845151424408, -0.25296223163604736, 0.8265087604522705, 0.42685574293136597, 0.48106446862220764, 0.4004597067832947, -0.0031223741825670004, 0.30093830823898315, -0.8227870464324951, -0.30947765707969666, -0.07229830324649811, -1.4861969947814941, -0.03326458856463432, -0.05484810099005699, 1.7764917612075806, 0.6936942934989929, 0.10094232112169266, -0.8566884398460388, 0.21413394808769226, -0.47805795073509216, -1.3578463792800903, -0.3215610384941101, -0.22366447746753693, -0.33265751600265503, -0.30526405572891235, -0.1295773983001709, -0.09073830395936966, 1.07956063747406, -0.10507572442293167, 1.4462839365005493, 0.03054657205939293, 1.1503121852874756, 0.3894336223602295, 0.7525182962417603, 0.058235153555870056, 0.22369268536567688, 0.8145474791526794, -1.4733457565307617, -0.8841066360473633, 0.2704137861728668, 1.0390820503234863, 1.317704677581787, 1.9693245887756348, -0.30058035254478455, 0.0007431712583638728, -0.9695695042610168, -0.21949335932731628, 0.6528189182281494, -1.4040179252624512, -0.34281599521636963, -0.8156645894050598, 0.167371466755867, 0.22670495510101318, 1.4696158170700073, 0.0946248471736908, 0.3539736568927765, -0.6454959511756897, -1.0087201595306396, -0.1741838902235031, 0.9773290157318115, 1.5731428861618042, 0.3053377866744995, -0.13378533720970154, -0.5130673050880432, -0.4086582660675049]
        const intercept1 = -1.8185094594955444
        const calibrator_x = [-2.1652987003326416, -1.3168703317642212, -1.3168690204620361, -0.884964644908905, -0.8848986625671387, -0.7292338013648987, -0.7291691303253174, -0.706413745880127, -0.7063314318656921, -0.6966915726661682, -0.6966888904571533, -0.4740630090236664, -0.47395431995391846, -0.4398573935031891, -0.43974751234054565, -0.430014967918396, -0.4298441410064697, -0.37798330187797546, -0.3778091371059418, -0.3727346658706665, -0.3726520836353302, -0.3169899582862854, -0.3168933689594269, -0.27917012572288513, -0.27893245220184326, -0.26322004199028015, -0.263215035200119, -0.22853407263755798, -0.22845123708248138, -0.18506333231925964, -0.18483205139636993, -0.13234646618366241, -0.13187357783317566, -0.08097876608371735, -0.08093283325433731, -0.0766114667057991, -0.07659046351909637, -0.014833908528089523, -0.014261572621762753, 0.00879144761711359, 0.009693538770079613, 0.022775784134864807, 0.02317296713590622, 0.07452476769685745, 0.07462005317211151, 0.09935974329710007, 0.0994960367679596, 0.10665339231491089, 0.10702867060899734, 0.11111882328987122, 0.11137540638446808, 0.17209453880786896, 0.17250408232212067, 0.2188701629638672, 0.21947526931762695, 0.30067434906959534, 0.30109894275665283, 0.32316944003105164, 0.3243272304534912, 0.386132150888443, 0.38661208748817444, 0.5088236331939697, 0.5089237689971924, 0.5872693061828613, 0.5875697731971741, 0.6464349031448364, 0.64857017993927, 0.7472629547119141, 0.750375509262085, 0.768618643283844, 0.7687231302261353, 0.8221521377563477, 0.8224443197250366, 1.0500284433364868, 1.050813913345337, 2.818720579147339]
        const calibrator_y = [0.0, 0.0, 0.0007077140617184341, 0.0007077140617184341, 0.004987531341612339, 0.004987531341612339, 0.007017544005066156, 0.007017544005066156, 0.007874015718698502, 0.007874015718698502, 0.008994276635348797, 0.008994276635348797, 0.012578615918755531, 0.012578615918755531, 0.024390242993831635, 0.024390242993831635, 0.025943396613001823, 0.025943396613001823, 0.03773584961891174, 0.03773584961891174, 0.04336043447256088, 0.04336043447256088, 0.04444444552063942, 0.04444444552063942, 0.06185567006468773, 0.06185567006468773, 0.0784313753247261, 0.0784313753247261, 0.08860759437084198, 0.08860759437084198, 0.09701492637395859, 0.09701492637395859, 0.10407239943742752, 0.10407239943742752, 0.1875, 0.1875, 0.19069766998291016, 0.19069766998291016, 0.19117647409439087, 0.19117647409439087, 0.2083333283662796, 0.2083333283662796, 0.22727273404598236, 0.22727273404598236, 0.25925925374031067, 0.25925925374031067, 0.2857142984867096, 0.2857142984867096, 0.29411765933036804, 0.29411765933036804, 0.3641975224018097, 0.3641975224018097, 0.47422680258750916, 0.47422680258750916, 0.4765625, 0.4765625, 0.5, 0.5, 0.5783132314682007, 0.5783132314682007, 0.7357142567634583, 0.7357142567634583, 0.824999988079071, 0.824999988079071, 0.920634925365448, 0.920634925365448, 0.9285714030265808, 0.9285714030265808, 0.9411764740943909, 0.9411764740943909, 0.9696969985961914, 0.9696969985961914, 0.9788732528686523, 0.9788732528686523, 1.0, 1.0]

        // useful functions 
        function dot_product(arr1, arr2) {
            let res = 0.0; 
            for (let i=0; i< arr1.length; i++) {
                res += arr1[i] * arr2[i]; 
            }
            return res;
        }

        function get_calib(x) {
            // binary search to find closest. it'll be faster than linear scan by a little bit 

            let small = 0 ;
            let large = 75; 

            while (large-small > 1){
                let mid = Math.floor((small+large)/2); 
                if (calibrator_x[mid] > x) { 
                    large = mid; // so large will be >x, always, unless it's the max that's clipped in which it will be equal 
                } else { 
                    small = mid ;
                }
            }
            //console.log("SMAL"); 
            //console.log(small);

            if (Math.abs(calibrator_x[small]-x) < Math.abs(calibrator_x[large]-x)){ 
                // small is closer to x than large 
                return calibrator_y[small] ;
            }
            return calibrator_y[large] ;
        }


        async function predict(in_text) {
            //console.log(in_text)
            let embeddings = await get_embeddings(in_text); 
            //console.log(embeddings); 
            //console.log(lc_1);

            let lc_out = dot_product(embeddings, lc_1) ;
            //console.log("MIDDLE");
            //console.log(lc_out + intercept1); 
            let res = get_calib(lc_out + intercept1); 
            //console.log("RES:");
            //console.log(res); 
            return res; 
            
        }

        function initialize() {
            //console.log("LAODED");
            const textInput = document.getElementById("textInput");
            const analyzeButton = document.getElementById("analyzeButton");
            const resultDisplay = document.getElementById("result");
            //console.log(analyzeButton);
    
            analyzeButton.addEventListener("click", async () => {
                const text = textInput.value.trim();
                //console.log("TEXT:");
                //console.log(text);
                if (text === "") {
                    resultDisplay.textContent = "Please enter some text.";
                    return;
                }
                
                try {
                    const score = await predict(text);
                    resultDisplay.textContent = `Suspicion Score: ${score.toFixed(2)}`;
                } catch (error) {
                    console.error("Error running prediction:", error);
                    resultDisplay.textContent = "Error analyzing text.";
                }
            });
        }


        console.log("MM");
        if (document.readyState !== 'loading') {
            console.log('document is already ready, just execute code here');
            initialize();
        } else {
            document.addEventListener('DOMContentLoaded', function () {
                console.log('document was not ready, place code here');
                initialize();
            });
        }
    </script>
    
</body>
</html>
